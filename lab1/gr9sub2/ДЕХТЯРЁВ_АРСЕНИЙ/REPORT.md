# Отчёт по Лабораторной 1 — Bash: анализ логов

## Среда

Для выполнения Лабораторной работы 1 использовалась Ubuntu 22.04 LTS на личном компьютере.
Также использовался сервер в облаке на Ubuntu 24.04 LTS для зания Б), пункт 2.

## Цель работы

Ознакомиться с базовыми командами, используемые при администрировании Linux систем, а также изучить команды используемые для форматирования и обработки вывода для поиска или изменения интересующих нас данных.

## Шаги выполнения и использованные команды


### Задание А

Частотный анализ слов в syslog (TOP‑5)
- Подсчитайте 5 самых частых “слов” в `/var/log/syslog` (нормализуйте регистр, отделяйте слова).

Для выполнения задания выполнил предложенную команду:
```bash
cat /var/log/syslog \
  | tr -cs '[:alnum:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```
Так как команда выполнялась неприлично долгое время я её отменил и изменил так, чтобы она считала 5 самых частых “слов” в последних 100000 строк файла:
```bash
tail -n 100000 /var/log/syslog \
  | tr -cs '[:alnum:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```

Вывод команды:
```
 100224 lenovo
 100024 y530
 100024 legion
 100024 15ich
  49257 gnome
```

Самые частые слова это слова названия хоста моего компьютера. `gnome` - это графическое окружение, установленное на моём компьютере.

Всего строк в файле:
```bash
$ wc -l /var/log/syslog
1012974 /var/log/syslog
```

Для того, чтобы разобраться в том, как работают команды, запустил каждую из них с флагом `--help` и прочитал описание

Для теста можно использовать файл [syslog_100000_lines.log](logs/syslog_100000_lines.log)

```bash
cat logs/syslog_100000_lines.log \
  | tr -cs '[:alnum:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```

### Задание Б

Неудачные попытки входа (auth.log)
- Найдите строки с `Failed` или `Invalid` в `/var/log/auth.log`.
- Извлеките IP‑адреса, посчитайте TOP‑10 источников.
- Замаскируйте последний октет IP (например, `192.168.0.15 → 192.168.0.x`) с помощью `sed`.
  - Подсказка: используйте `grep -E`, `awk`/`cut`, `sort | uniq -c | sort -nr`, и `sed -E 's/(\d+\.\d+\.\d+\.)\d+/\1x/g'`.

**Найдите строки с `Failed` или `Invalid` в `/var/log/auth.log`.**

Поиск строк осуществил командой:
```bash
grep -i -e "failed" -e "invalid" /var/log/auth.log
```

Вывод команды:
``` bash
$ grep -i -e "failed" -e "invalid" /var/log/auth.log
Sep 18 23:26:47 Lenovo-Legion-Y530-15ICH su: FAILED SU (to lufus) lufus on pts/1
Sep 18 23:26:54 Lenovo-Legion-Y530-15ICH su: FAILED SU (to lufus) lufus on pts/1
Sep 18 23:27:03 Lenovo-Legion-Y530-15ICH su: FAILED SU (to root) lufus on pts/1
```

`Invalid` В выводе не было, так как эта ошибка появляется сугубо при попытке удалённого подключения с использованием демона `sshd`, который у меня отключен.

**Извлеките IP‑адреса, посчитайте TOP‑10 источников.**

Попробовал найти все IP адреса в /var/log/auth.log такой командой:
```bash
grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' /var/log/auth.log | sort | uniq -с | head -n 10
```
На личном компьютере ничего не вывелось, так как отсутствует возможность удалённого подключения.

Запустил такую же команду на сервере в облаке:
```bash
$ grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' /var/log/auth.log | sort | uniq -с | head -n 10
      4 10.33.20.32
      5 10.33.25.76
```

Как видно, вход осуществлялся только с двух IP адресов.

**Замаскируйте последний октет IP (например, `192.168.0.15 → 192.168.0.x`) с помощью `sed`.**

Получилась такая команда:
```bash
$ echo "192.154.123.1" | sed -E "s@[0-9]{1,3}\$@x@"
192.154.123.x
```

Протестировать команду можно на файле [ips](logs/ips)
```bash
$ cat logs/ips | sed -E "s@[0-9]{1,3}\$@x@"
192.168.0.x
192.168.0.x
192.168.0.x
192.168.0.x
192.168.0.x
192.168.0.x
10.22.10.x
10.22.10.x
10.22.10.x
10.22.10.x
127.0.0.x
127.1.1.x
172.16.0.x
172.31.0.x
172.29.125.x
```

### Задание В

В) Установки пакетов (dpkg.log)
- По `/var/log/dpkg.log` посчитайте, какие пакеты устанавливались чаще всего (события `install`).
- Выведите TOP‑10 пакетов с количеством установок.

Для вывода топ 10 пакетов с количеством установок использовал такую команду:
```bash
$ grep /var/log/dpkg.log -i -we "installed" | grep -i -v -e "half-installed" -e "not-installed" | cut -d ' ' -f 5 | cut -d ':' -f 1 | uniq -c | head -n 10
      2 libxml2
      1 libc-bin
      1 python3-apport
      1 apport
      1 man-db
      1 hicolor-icon-theme
      1 gcc-11-base
      1 libasan6
      1 libtsan0
      1 cpp-11
```

Для теста можно использовать файл [dpkg.log](logs/dpkg.log):
```bash
$ grep logs/dpkg.log -i -we "installed" | grep -i -v -e "half-installed" -e "not-installed" | cut -d ' ' -f 5 | cut -d ':' -f 1 | uniq -c | head -n 10
      2 libxml2
      1 libc-bin
      1 python3-apport
      1 apport
      1 man-db
      1 hicolor-icon-theme
      1 gcc-11-base
      1 libasan6
      1 libtsan0
      1 cpp-11
```
