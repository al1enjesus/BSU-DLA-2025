# Лабораторная 1 — Bash: анализ логов

**Студент:** Соков Владислав  
**Операционная система:** Ubuntu 24.04.3 LTS  
**Ядро:** Linux 6.6.87.2-microsoft-standard-WSL2  

## Цель

Выполнить анализ логов системы (`syslog`, `auth.log`, `dpkg.log`) с использованием стандартных инструментов UNIX (`grep`, `awk`, `sed`, `sort`, `uniq` и т.д.), составить воспроизводимый REPORT.MD с командами и ключевыми выводами.

## A) Частотный анализ слов в `syslog` (TOP‑5)

**Задача:** Подсчитайте 5 самых частых “слов” в `/var/log/syslog` (нормализуйте регистр, отделяйте слова).

**Команды:**

```bash
# 1) Разбиваем на слова, нормализуем регистр, исключаем полностью цифровые слова, считаем частоты и выводим TOP-5
cat /var/log/syslog \
  | tr -cs '[:alnum:]' '\n' \
  | tr '[:upper:]' '[:lower:]' \
  | grep -v -E '^[0-9]+$' \
  | grep -v '^$' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 5
```

**Краткое пояснение:**

* `tr -cs '[:alnum:]' '\n'` — преобразует всё в отдельные слова, разделяя не буквенно-цифровые символы.
* `tr '[:upper:]' '[:lower:]'` — приведение к нижнему регистру.
* `grep -v -E '^[0-9]+$'` — удаляем слова, которые полностью состоят из цифр.
* `grep -v '^$'` — удаляем пустые строки.
* Дальше `sort | uniq -c | sort -nr` — стандартный подсчёт частот.

**Ожидаемый формат вывода:**

```
   9334 lenovo
   5347 to
   5233 service
   4298 wsl
   4269 pro
```

**Ключевой вывод:** чаще всего встречаются `lenovo`, `to`, `service` и т.д..

## Б) Неудачные попытки входа (auth.log)

**Задача:** Найти строки содержащие `Failed` или `Invalid` в `/var/log/auth.log`, извлечь IP‑адреса, посчитать TOP‑10 источников и замаскировать последний октет в виде `x` с помощью `sed`.

**Команды:**

```bash
# 1) Найти строки с Failed/Invalid
grep -E 'Failed|Invalid' /var/log/auth.log > /tmp/failed_invalid_lines.log

# 2) Извлечь IP-адреса (IPv4) из найденных строк, посчитать TOP-10 и замаскировать последний октет
cat /tmp/failed_invalid_lines.log \
  | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' \
  | sed -E 's/([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+/\1x/g' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

**Пояснения:**

* Сначала выбираем релевантные строки, чтобы не сканировать весь файл несколько раз.
* `grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}'` — извлекает все подходящие по синтаксису IPv4 адреса.
* `sed -E 's/([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+/\1x/g'` — заменяет последний октет на `x`.

**Ожидаемый формат вывода:**

```
  120 203.0.113.x
   87 198.51.100.x
   44 192.0.2.x
   12 10.0.0.x
   10 172.16.5.x
```

**Ключевой вывод:** по маскированным подсетям можно увидеть, откуда приходят основные неудачные попытки входа; при необходимости далее исследуем по полным IP.

## В) Установки пакетов (dpkg.log)

**Задача:** По `/var/log/dpkg.log` посчитать, какие пакеты устанавливались чаще всего (события `install`) и вывести TOP‑10.

**Команды:**

```bash
# 1) Извлекаем строки с install, достаём имя пакета и считаем
grep ' install ' /var/log/dpkg.log \
  | awk '{for(i=1;i<=NF;i++) if($i=="install") {print $(i+1); break}}' \
  | sed -E 's/:.*$//g' \
  | sort \
  | uniq -c \
  | sort -nr \
  | head -n 10
```

**Пояснения:**

* `grep ' install '` — ищем события `install` (с пробелами, чтобы не захватывать, например, `installation`).
* `awk` находит слово `install` и печатает следующий столбец (имя пакета с возможной архитектурой `:amd64`).
* `sed -E 's/:.*$//g'` — убираем архитектуру из имени пакета.

**Ожидаемый формат вывода:**

```
   25 python3
   12 libc6
   11 openssh-server
    9 curl
    8 make
```

**Ключевой вывод:** список наиболее часто устанавливаемых пакетов (часто это зависимости или пакеты, повторно установленные в процессе автоматических обновлений).

## Ответы на формальные вопросы

* **Цель:** научиться анализировать системные журналы с помощью командной строки и выявлять ключевые события (частые слова, попытки входа, установки пакетов).
* **Как проверял:** запуск команд и просмотр верхних строк вывода.
* **Как использовал AI:** AI помог написать объяснения и шаблонный REPORT.MD. Все команды — стандартные и безопасные.
