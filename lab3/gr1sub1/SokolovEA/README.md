# Lab 3 - pstat утилита и диагностика процессов

Автор: Соколов Егор Александрович  
Группа: 1, подгруппа: 1

## Описание

Реализация утилиты `pstat` для чтения метрик процесса из файловой системы `/proc` и сравнения с системными утилитами.

## Структура проекта

```
SokolovEA/
├── src/
│   ├── pstat.c          # Основная утилита с расширенными возможностями
│   ├── monitor.sh       # Скрипт непрерывного мониторинга
│   ├── Makefile         # Сборка проекта
│   ├── bin/             # Скомпилированная утилита (создается при сборке)
│   └── obj/             # Объектные файлы (создается при сборке)
├── run.sh               # Скрипт демонстрации
├── README.md            # Этот файл
└── REPORT.MD            # Отчет по лабораторной работе
```

## Сборка и запуск

### Быстрый запуск (демонстрация)
```bash
./run.sh
```

### Ручная сборка
```bash
cd src/
make all          # Сборка утилиты pstat
```

### Использование утилиты

**Базовое использование:**
```bash
./src/bin/pstat <pid>
```

**С дополнительными опциями:**
```bash
./src/bin/pstat -v <pid>         # Подробный вывод
./src/bin/pstat -j <pid>         # JSON формат
./src/bin/pstat -m <pid>         # Режим мониторинга
./src/bin/pstat -m -i 1 <pid>    # Мониторинг с интервалом 1 сек
./src/bin/pstat -h               # Справка
```

**Примеры:**
```bash
./src/bin/pstat 1                # Информация о процессе init
./src/bin/pstat $$               # Информация о текущем shell процессе
./src/bin/pstat -j 1             # JSON вывод для процесса init
./src/bin/pstat -v $$            # Подробная информация о shell
```

### Очистка
```bash
cd src/
make clean
```

## Возможности утилиты

Утилита `pstat` читает следующие файлы из `/proc/<pid>/`:
- `stat` - базовая статистика процесса
- `status` - детальная информация о статусе
- `io` - статистика ввода-вывода (требует прав root)

### Выводимые метрики:
- **PPid** - ID родительского процесса
- **Command** - имя команды процесса
- **Threads** - количество потоков
- **State** - текущее состояние процесса
- **User/System time** - время выполнения в пользовательском/системном режиме
- **CPU time** - общее время выполнения в секундах (с динамическим HZ)
- **Context switches** - добровольные и принудительные переключения контекста
- **Memory usage** - VmRSS, RssAnon, RssFile с форматированием в KiB/MiB/GiB
- **IO statistics** - количество прочитанных/записанных байт

### Режимы работы:
- **Базовый режим** - стандартный вывод информации
- **Подробный режим (-v)** - дополнительные детали (виртуальная память, тики)
- **JSON режим (-j)** - структурированный вывод для автоматизации
- **Режим мониторинга (-m)** - непрерывное обновление данных

## Системные требования

- Linux с файловой системой `/proc`
- GCC компилятор
- Make
- Опционально: `strace`, `perf`, `pidstat` для сравнения

## Ограничения

- Файл `/proc/<pid>/io` может быть недоступен без прав root
- На WSL2 некоторые метрики могут отличаться от нативного Linux
- `perf` может требовать дополнительных прав или настроек

## Тестирование

Скрипт `run.sh` автоматически:
1. Собирает утилиту
2. Демонстрирует работу на текущем bash процессе
3. Сравнивает результаты с `ps`, `top`, `pidstat`
4. Показывает использование диагностических утилит `strace` и `perf`