# Lab 3 - pstat утилита и диагностика процессов

Автор: Соколов Егор Александрович  
Группа: 1, подгруппа: 1

## Описание

Реализация утилиты `pstat` для чтения метрик процесса из файловой системы `/proc` и сравнения с системными утилитами.

## Структура проекта

```
SokolovEA/
├── src/
│   ├── pstat.c          # Основная версия утилиты
│   ├── pstat_advanced.c # Расширенная версия с дополнительными опциями
│   ├── monitor.sh       # Скрипт непрерывного мониторинга
│   ├── Makefile         # Сборка проекта
│   ├── bin/             # Скомпилированные утилиты (создается при сборке)
│   └── obj/             # Объектные файлы (создается при сборке)
├── run.sh               # Скрипт демонстрации
├── README.md            # Этот файл
└── REPORT.MD            # Отчет по лабораторной работе
```

## Сборка и запуск

### Быстрый запуск (демонстрация)
```bash
./run.sh
```

### Ручная сборка
```bash
cd src/
make all          # Основная версия
make advanced     # Расширенная версия с дополнительными опциями
```

### Использование утилиты

**Основная версия:**
```bash
./src/bin/pstat <pid>
```

**Расширенная версия:**
```bash
# Базовое использование
./src/bin/pstat_advanced <pid>

# С дополнительными опциями
./src/bin/pstat_advanced -v <pid>         # Подробный вывод
./src/bin/pstat_advanced -j <pid>         # JSON формат
./src/bin/pstat_advanced -m <pid>         # Режим мониторинга
./src/bin/pstat_advanced -m -i 1 <pid>    # Мониторинг с интервалом 1 сек
```

**Примеры:**
```bash
./src/bin/pstat 1                    # Информация о процессе init
./src/bin/pstat $$                   # Информация о текущем shell процессе
./src/bin/pstat_advanced -j 1        # JSON вывод для процесса init
./src/bin/pstat_advanced -v $$       # Подробная информация о shell
```

### Очистка
```bash
cd src/
make clean
```

## Возможности утилиты

Утилита `pstat` читает следующие файлы из `/proc/<pid>/`:
- `stat` - базовая статистика процесса
- `status` - детальная информация о статусе
- `io` - статистика ввода-вывода (требует прав root)

### Выводимые метрики:
- **PPid** - ID родительского процесса
- **Threads** - количество потоков
- **State** - текущее состояние процесса
- **User/System time** - время выполнения в пользовательском/системном режиме
- **CPU time** - общее время выполнения в секундах
- **Context switches** - добровольные и принудительные переключения контекста
- **Memory usage** - VmRSS, RssAnon, RssFile с форматированием в KiB/MiB
- **IO statistics** - количество прочитанных/записанных байт

## Системные требования

- Linux с файловой системой `/proc`
- GCC компилятор
- Make
- Опционально: `strace`, `perf`, `pidstat` для сравнения

## Ограничения

- Файл `/proc/<pid>/io` может быть недоступен без прав root
- На WSL2 некоторые метрики могут отличаться от нативного Linux
- `perf` может требовать дополнительных прав или настроек

## Тестирование

Скрипт `run.sh` автоматически:
1. Собирает утилиту
2. Демонстрирует работу на текущем bash процессе
3. Сравнивает результаты с `ps`, `top`, `pidstat`
4. Показывает использование диагностических утилит `strace` и `perf`