# Лабораторная работа №3 — /proc, собственные метрики и диагностика

## Студент: Цыбенко Кирилл
## Группа: gr1sub1 
## Дата: 16.11.2025

---

## Цель работы

- Освоить чтение и интерпретацию метрик процессов из `/proc`.  
- Сравнить показатели `/proc` с системными утилитами (`ps`, `top`, `pidstat`).  
- Провести базовую диагностику процессов через `strace` и `perf`.  
- Научиться автоматически завершать процессы после анализа.

---

## Шаги работы

1. **Подготовка окружения:**

```bash
sudo apt update && sudo apt install -y procps psmisc util-linux sysstat strace perf

    Создание утилиты и скрипта запуска:

    pstat.py — утилита для чтения /proc/<pid>: stat, status, io, smaps_rollup.

    run.sh — скрипт демонстрации:

        запускает процесс yes (нагрузка CPU),

        собирает метрики через pstat.py, ps, pidstat, top, strace и perf,

        завершает процесс после анализа,

        сохраняет вывод в src/demo.log и src/strace.log.

    Запуск тестового процесса:

sudo ./run.sh

Вывод в demo.log:

[*] Запуск тестового процесса (CPU burn)
PID=7806

=== pstat.py ===
Process yes (pid=7806)
  PPid: 7801
  State: R
  Threads: 1
  CPU time: user=0.24s sys=0.77s total=1.01s
  Voluntary ctxt switches: 0
  Nonvoluntary ctxt switches: 10
  VmRSS: 1812 kB
  read_bytes: 0
  write_bytes: 0

=== ps ===
    PID    PPID S NLWP   RSS COMMAND
   7806    7801 R    1  1812 yes

=== pidstat ===
03:49:30 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
03:49:31 PM   1000      7806   24.00   76.00    0.00    0.00  100.00     5  yes
Average:     1000      7806   24.00   76.00    0.00    0.00  100.00     -  yes

=== top (1 итерация) ===
PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
7806 user      20   0    8288   1812   1812 R 100.0   0.0   0:02.22 yes

=== strace -c ===
Сводка системных вызовов (вывод автоматически в strace.log)

=== perf stat ===
perf stat требует root и доступ к perf

[*] Процесс 7806 завершён

    Комментарии к результатам:

   Процесс yes активно использовал процессор, что видно по состоянию R и 100% загрузки CPU в top и pidstat.

    Утилита pstat.py корректно отобразила:

    PID, PPID, состояние процесса, число потоков,

    время CPU, контекстные переключения, VmRSS и ввод-вывод.

    Сравнение с ps и pidstat показало полное совпадение ключевых метрик.

    Процесс был завершён после анализа, что исключает его дальнейшую работу в системе.

Выводы

    Метрики, полученные из /proc, полностью соответствуют данным системных утилит.

    Нагрузку на процессор можно достоверно отслеживать через pstat.py, top и pidstat.

    Автоматическое завершение процесса после анализа позволяет избежать нежелательной нагрузки на систему.

    Для работы с некоторыми инструментами (perf, strace с attach) требуются права sudo.

    Успешно созданы логи демонстрации: demo.log и strace.log в папке src/.