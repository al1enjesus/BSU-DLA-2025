# Кейлоггер на основе модуля ядра

Модуль ядра для Linux, который перехватывает и логирует нажатия клавиш.

**Внимание**: Этот код предназначен исключительно для образовательных целей. Использование кейлоггеров без явного согласия пользователя является нарушением закона во многих странах.

## Возможности

- Перехватывает нажатия клавиш на системном уровне.
- Записывает **ВСЕ** символы (включая пароли) в лог-файл `/root/kkey`.
- Поддерживает асинхронную запись в файл через workqueues для минимизации задержек.
- Использует двойную буферизацию с защитой spinlock для предотвращения гонок данных.
- Лог-файл создаётся с правами доступа `0600` (только root может читать).

## Требования

Для сборки и запуска модуля необходимы:

1.  **Права суперпользователя** (`root`) для загрузки/выгрузки модуля.
2.  **Заголовочные файлы ядра Linux.** Обычно их можно установить командой:
    - Для Debian/Ubuntu: `sudo apt install linux-headers-$(uname -r)`
    - Для Fedora/CentOS: `sudo dnf install kernel-devel-$(uname -r)`

## Сборка

Для компиляции модуля выполните команду:

```bash
make
```

В результате будет создан файл `keylogger.ko`.

## Использование

### Загрузка модуля

Чтобы загрузить модуль выполните:

```bash
sudo insmod keylogger.ko
```

### Просмотр логов

Для просмотра активности модуля и логов используйте команды:

```bash
# Проверить, что модуль загружен
lsmod | grep keylogger

# Посмотреть сообщения модуля (загружен, выгружен, ошибки)
dmesg | grep kkey

# Посмотреть содержимое лог-файла
sudo cat /root/kkey
```

**Пример вывода лог-файла:**

```
hello_SHIFT_world_ENTER_
test_BACKSPACE__BACKSPACE__BACKSPACE__BACKSPACE_demo
```

### Выгрузка модуля

Для остановки кейлоггера и выгрузки модуля выполните:

```bash
sudo rmmod keylogger
```

## Очистка

Чтобы удалить все сгенерированные при сборке файлы, выполните:

```bash
make clean
```

## Тестирование

**Рекомендуется тестировать только на виртуальной машине!**

Модуль протестирован на:

- Linux kernel 5.15+
- Ubuntu 20.04/22.04
- Debian 11/12

## Troubleshooting

**Проблема**: Модуль не загружается (ошибка `insmod`)

- **Решение**: Убедитесь, что установлены заголовки ядра: `sudo apt install linux-headers-$(uname -r)`

**Проблема**: Не создаётся лог-файл

- **Решение**: Проверьте права доступа к директории и существование пути. Используйте `dmesg | grep kkey` для просмотра ошибок.

**Проблема**: Модуль не выгружается

- **Решение**: Дождитесь завершения записи в файл. Если не помогает, перезагрузите систему.
