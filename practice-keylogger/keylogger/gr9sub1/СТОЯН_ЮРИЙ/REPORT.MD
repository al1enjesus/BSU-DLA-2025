# Keylogger Kernel Module

**Студент:** Стоян Юрий, группа 9/1.

## 1. Цель работы

Изучить механизм работы модулей ядра Linux, освоить API для перехвата событий клавиатуры (`keyboard notifier`) и реализовать модуль-кейлоггер с асинхронной записью данных в файл.

## 2. Шаги выполнения

1.  **Проектирование модуля**:

    - Определена основная логика: перехват события, преобразование скан-кода в символ, буферизация и запись в файл для последующего изучения.
    - Для асинхронной записи выбраны рабочие очереди (`workqueue`), чтобы не блокировать обработчик прерывания клавиатуры.


2.  **Реализация**:

    - Написан код модуля `keylogger.c`.
    - Для перехвата событий использована функция `register_keyboard_notifier`, которая регистрирует callback-функцию, вызываемую при каждом событии клавиатуры.
    - В callback-функции (`keyboard_callback`) происходит фильтрация событий (только нажатия клавиш), преобразование скан-кода в строку и сохранение в активный буфер.

3.  **Сборка и отладка**:
    - Создан `Makefile` для компиляции модуля с помощью системы сборки ядра Linux.
    - Данная программа реализована в Virtual Box Oracle на ОС Ubuntu 22.04 LTS

## 3. Выводы

В ходе работы были изучены:

- Жизненный цикл модулей ядра (`init`, `exit`).
- Механизм `notifiers` для подписки на события ядра.
- Работу с файловой системой из пространства ядра (`filp_open`, `kernel_write`, `filp_close`).
- Важность асинхронной обработки данных для производительности системы.
- Риски, связанные с разработкой в пространстве ядра: одна ошибка может привести к `Kernel Panic`.

Реализованный модуль успешно перехватывает нажатия клавиш и сохраняет их в лог-файл, демонстрируя понимание ключевых концепций.

## 4. Ответы на контрольные вопросы

**Вопрос 1: Почему нельзя выполнять длительные операции (например, запись в файл) напрямую в callback-функции `notifier`?**
_Ответ:_ Callback-функция `notifier` для событий клавиатуры выполняется в контексте прерывания (atomic context). В этом контексте блокирующие операции, такие как прямая запись на диск, недопустимы, так как это заморозит обработку других важных системных событий и может привести к зависанию или падению системы. Для этого и используются механизмы отложенного выполнения, такие как `workqueue`.

**Вопрос 2: Какие риски безопасности несёт в себе разработанный модуль?**
_Ответ:_ Основной риск — несанкционированный доступ к конфиденциальной информации (паролям, личной переписке). Поскольку модуль работает на уровне ядра, он может перехватить абсолютно все нажатия клавиш в системе. Любая уязвимость в самом модуле (например, переполнение буфера) может быть использована для компрометации всей операционной системы.

## 5. Проверка

1.  Модуль компилировался командой `make`.
2.  Загружался в ядро: `sudo insmod keylogger.ko`.
3.  В том же терминале были прописаны некоторые команды и команды CTRL+C и CTRL+V ЛКМ и ПКМ
4.  Содержимое лог-файла проверялось: `sudo cat /var/log/kkey.log`.
5.  Корректность выгрузки проверялась командой `sudo rmmod keylogger` и просмотром `dmesg`.