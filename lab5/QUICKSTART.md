# Lab 5 - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–í–ê–ñ–ù–û: –ü–†–û–ß–ò–¢–ê–ô–¢–ï –ü–û–õ–ù–û–°–¢–¨–Æ!)

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ü–†–ï–í–´–®–ï –í–°–ï–ì–û! üö®

### ‚ö†Ô∏è –≠—Ç–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ!

**–ü–û–ß–ï–ú–£ –≠–¢–û –¢–ê–ö –í–ê–ñ–ù–û:**

–ú–æ–¥—É–ª–∏ —è–¥—Ä–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ **kernel space** - –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å –ø–æ–ª–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ. –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ –º–æ–¥—É–ª—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:

- üí• **Kernel Panic** - –ø–æ–ª–Ω—ã–π –∫—Ä–∞—Ö —Å–∏—Å—Ç–µ–º—ã
- üî• **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö** - –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É
- üêõ **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- üîí **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏** - –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. **VirtualBox** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö)
   - –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
   - –õ–µ–≥–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å snapshot

2. **VMware Workstation/Fusion** (–µ—Å–ª–∏ –µ—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—è)
   - –ë–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ
   - Snapshot —Ñ—É–Ω–∫—Ü–∏—è

3. **Docker —Å --privileged** (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
   - –ù–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è Docker

### ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï –ù–ê:

- ‚ùå –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (–≤–∞—à —Ä–∞–±–æ—á–∏–π –∫–æ–º–ø—å—é—Ç–µ—Ä)
- ‚ùå –ù–æ—É—Ç–±—É–∫–µ —Å –≤–∞–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚ùå –°–µ—Ä–≤–µ—Ä–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (!!!!)
- ‚ùå macOS –Ω–∞–ø—Ä—è–º—É—é (—è–¥—Ä–æ –¥—Ä—É–≥–æ–µ)

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (15-20 –º–∏–Ω—É—Ç)

### –í–∞—Ä–∏–∞–Ω—Ç A: VirtualBox + Ubuntu (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ VirtualBox**
```bash
# –ù–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ
# –°–∫–∞—á–∞–π—Ç–µ —Å https://www.virtualbox.org/
# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
```

**–®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ VM —Å Ubuntu**
- –°–∫–∞—á–∞–π—Ç–µ Ubuntu 22.04 –∏–ª–∏ 24.04 ISO
- –°–æ–∑–¥–∞–π—Ç–µ VM:
  - RAM: –º–∏–Ω–∏–º—É–º 2 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4 GB)
  - Disk: 20 GB
  - CPU: 2 cores
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ubuntu

**–®–∞–≥ 3: –°–¥–µ–ª–∞–π—Ç–µ snapshot "Clean Install"**
```
VirtualBox ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ VM ‚Üí Snapshots ‚Üí Take Snapshot
–ò–º—è: "Clean Ubuntu Install"
```

**–ó–∞—á–µ–º:** –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è, –≤–µ—Ä–Ω—ë—Ç–µ—Å—å –∫ —ç—Ç–æ–π —Ç–æ—á–∫–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!

**–®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã (–≤–Ω—É—Ç—Ä–∏ VM)**
```bash
sudo apt update
sudo apt install -y build-essential linux-headers-$(uname -r) \
     kmod vim git dkms

# –ü—Ä–æ–≤–µ—Ä–∫–∞
uname -r                         # –í–µ—Ä—Å–∏—è —è–¥—Ä–∞
ls /lib/modules/$(uname -r)/build  # Kernel headers
gcc --version                    # –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä
```

**–®–∞–≥ 5: –°–¥–µ–ª–∞–π—Ç–µ –≤—Ç–æ—Ä–æ–π snapshot "Ready for Development"**
```
VirtualBox ‚Üí Snapshots ‚Üí Take Snapshot
–ò–º—è: "Ready for Development"
```

---

### –í–∞—Ä–∏–∞–Ω—Ç B: Docker (–¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏
docker run -it --privileged \
    --name kernel-lab \
    -v $(pwd):/workspace \
    ubuntu:22.04 bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
apt update
apt install -y build-essential linux-headers-generic kmod vim

# –ü—Ä–æ–≤–µ—Ä–∫–∞
uname -r
ls /lib/modules/$(uname -r)/build
```

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:** Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ã! Kernel panic –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ = kernel panic —Ö–æ—Å—Ç–∞!

---

## 2. –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ (10 –º–∏–Ω—É—Ç)

### –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–≤–Ω—É—Ç—Ä–∏ VM)

```bash
git clone <URL_–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
cd BSU-OS-2025/lab5/samples/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make check
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
=== Environment Check ===
Kernel version: 5.15.0-...-generic
Kernel headers: ‚úì Found at /lib/modules/.../build
Build tools: ‚úì gcc installed
Module loading: ‚úì insmod available
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ ‚úó - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–∞–∫–µ—Ç—ã!

---

### –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã

```bash
make
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Building kernel modules...
make[1]: Entering directory '/usr/src/linux-headers-...'
  CC [M]  /path/to/lab5/samples/hello_module.o
  CC [M]  /path/to/lab5/samples/proc_module.o
  CC [M]  /path/to/lab5/samples/chardev_module.o
  ...
  LD [M]  /path/to/lab5/samples/hello_module.ko
  LD [M]  /path/to/lab5/samples/proc_module.ko
  LD [M]  /path/to/lab5/samples/chardev_module.ko
‚úì Modules built successfully!
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `make check`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ kernel headers —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é gcc (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —è–¥—Ä–æ–º)

---

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
sudo insmod hello_module.ko

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
dmesg | tail -5

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω
lsmod | grep hello_module

# –í—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
sudo rmmod hello_module

# –°–Ω–æ–≤–∞ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
dmesg | tail -5
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ dmesg:**
```
[12345.678] hello_module: Module loaded (TODO: implement greeting)
[12350.123] hello_module: Module unloaded (TODO: implement goodbye)
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è - –ø–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

---

## 3. –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (–ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ [README.md](README.md) –∏ –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–ü—Ä–∞–≤–∏–ª–æ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞":
- **–ù–µ—á—ë—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –ø–æ —Å–ø–∏—Å–∫—É** ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 1
- **–ß—ë—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –ø–æ —Å–ø–∏—Å–∫—É** ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 2

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–∞–ø–∫—É

```bash
cd ../../  # –í –∫–æ—Ä–µ–Ω—å lab5/
mkdir -p gr<–≥—Ä—É–ø–ø–∞>sub<–ø–æ–¥–≥—Ä—É–ø–ø–∞>/–§–ê–ú–ò–õ–ò–Ø_–ò–ú–Ø/src
cd gr<–≥—Ä—É–ø–ø–∞>sub<–ø–æ–¥–≥—Ä—É–ø–ø–∞>/–§–ê–ú–ò–õ–ò–Ø_–ò–ú–Ø/

# –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ñ–∞–π–ª—ã
touch REPORT.MD
cp ../../samples/Makefile .
```

### –®–∞–≥ 3: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫–µ–ª–µ—Ç—ã

```bash
cd src/
cp ../../../samples/hello_module.c .
cp ../../../samples/proc_module.c .
cp ../../../samples/chardev_module.c .
```

### –®–∞–≥ 4: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É

**–ó–∞–¥–∞–Ω–∏–µ A: Hello World** (30 –º–∏–Ω—É—Ç)
1. –û—Ç–∫—Ä–æ–π—Ç–µ `hello_module.c`
2. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ `// TODO:`
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏
4. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ: `make`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
   ```bash
   sudo insmod hello_module.ko
   dmesg | tail -5
   sudo insmod hello_module.ko message="Test"
   dmesg | tail -5
   sudo rmmod hello_module
   ```

**–ó–∞–¥–∞–Ω–∏–µ B: /proc —Ñ–∞–π–ª** (1-2 —á–∞—Å–∞)
1. –û—Ç–∫—Ä–æ–π—Ç–µ `proc_module.c`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ TODO
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
   ```bash
   sudo insmod proc_module.ko
   cat /proc/student_info
   cat /proc/student_info  # –°—á—ë—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è!
   sudo rmmod proc_module
   ```

**–ó–∞–¥–∞–Ω–∏–µ C: Character Device** (2-3 —á–∞—Å–∞)
1. –û—Ç–∫—Ä–æ–π—Ç–µ `chardev_module.c`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ TODO
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Ñ–∞–π–ª–µ)

---

## 4. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "ERROR: could not insert module: Invalid module format"

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–¥—É–ª—å —Å–æ–±—Ä–∞–Ω –¥–ª—è –¥—Ä—É–≥–æ–π –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
make clean
make
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ kernel headers
ls /lib/modules/$(uname -r)/build
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: "ERROR: could not insert module: Operation not permitted"

**–ü—Ä–∏—á–∏–Ω–∞ 1:** –ù–µ—Ç –ø—Ä–∞–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo insmod module.ko  # –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ root
```

**–ü—Ä–∏—á–∏–Ω–∞ 2:** Secure Boot

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Secure Boot
mokutil --sb-state

# –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω, –ª–∏–±–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –≤ BIOS, –ª–∏–±–æ –ø–æ–¥–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å
# (–î–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π –ø—Ä–æ—â–µ –æ—Ç–∫–ª—é—á–∏—Ç—å Secure Boot –≤ VM)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: Kernel Panic!

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. **–ù–µ –ø–∞–Ω–∏–∫—É–π—Ç–µ!** (–∫–∞–ª–∞–º–±—É—Ä intended)
2. –ï—Å–ª–∏ VM –∑–∞–≤–∏—Å–ª–∞ - Force Power Off —á–µ—Ä–µ–∑ VirtualBox
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ snapshot "Ready for Development"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –Ω–∞ –æ—à–∏–±–∫–∏:
   - –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ NULL —É–∫–∞–∑–∞—Ç–µ–ª—è–º?
   - –í—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞?
   - –ó–∞–±—ã–ª–∏ copy_to_user/copy_from_user?
5. –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ printk –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
6. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

**–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:**
- –î–µ–ª–∞–π—Ç–µ snapshot –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–º
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Å–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ NULL
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ copy_to_user/copy_from_user
- –ù–µ –¥–µ–ª–∞–π—Ç–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Module is in use"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö—Ç–æ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å (—Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–æ–¥—É–ª—å
# –î–ª—è character device:
sudo rm /dev/mychardev  # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ device node
sudo rmmod chardev_module

# –î–ª—è proc —Ñ–∞–π–ª–∞:
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ —á–∏—Ç–∞–µ—Ç /proc —Ñ–∞–π–ª
sudo rmmod proc_module
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ –≤ dmesg

**–ü—Ä–∏—á–∏–Ω–∞:** –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
cat /proc/sys/kernel/printk
# –ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ - —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å (7 = –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
echo 7 > /proc/sys/kernel/printk

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dmesg —Å –æ–ø—Ü–∏—è–º–∏
dmesg --level=info,notice,warn,err
```

---

## 5. –û—Ç–ª–∞–¥–∫–∞ –º–æ–¥—É–ª–µ–π

### –¢–µ—Ö–Ω–∏–∫–∏ –æ—Ç–ª–∞–¥–∫–∏:

**1. printk - –≤–∞—à –ª—É—á—à–∏–π –¥—Ä—É–≥**
```c
printk(KERN_DEBUG "Entering function %s\n", __func__);
printk(KERN_DEBUG "Value: %d, Pointer: %p\n", val, ptr);
printk(KERN_DEBUG "About to call risky function\n");
risky_function();
printk(KERN_DEBUG "Survived risky function\n");
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞**
```c
if (!ptr) {
    printk(KERN_ERR "Pointer is NULL!\n");
    return -EINVAL;
}
printk(KERN_DEBUG "Pointer is valid: %p\n", ptr);
```

**3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
```bash
# –í –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
dmesg -w

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
sudo insmod module.ko
# –°—Ä–∞–∑—É –≤–∏–¥–∏—Ç–µ –≤—ã–≤–æ–¥!
```

**4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏**
```bash
# –î–æ –∑–∞–≥—Ä—É–∑–∫–∏
cat /proc/meminfo | grep Slab

# –ó–∞–≥—Ä—É–∑–∏—Ç—å/–≤—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
sudo insmod module.ko
sudo rmmod module
sudo insmod module.ko
sudo rmmod module

# –ü–æ—Å–ª–µ –≤—ã–≥—Ä—É–∑–∫–∏
cat /proc/meminfo | grep Slab
# Slab –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏
```

---

## 6. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π

### –ö–æ–¥:
- [ ] –í—Å–µ TODO —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- [ ] –ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: `sudo insmod`
- [ ] –ú–æ–¥—É–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è)
- [ ] –ú–æ–¥—É–ª—å –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è: `sudo rmmod`
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- [ ] –ó–∞–ø–æ–ª–Ω–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (MODULE_AUTHOR, MODULE_DESCRIPTION)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞/–≤—ã–≥—Ä—É–∑–∫–∞ 3+ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –õ–æ–≥–∏ –≤ dmesg –ø–æ–Ω—è—Ç–Ω—ã –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã
- [ ] –ù–µ—Ç kernel panic
- [ ] –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥—É–ª–µ–º

### –û—Ç—á—ë—Ç:
- [ ] –°–æ–∑–¥–∞–Ω REPORT.MD
- [ ] –û–ø–∏—Å–∞–Ω—ã –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã dmesg, lsmod, —Ç–µ—Å—Ç–æ–≤
- [ ] –î–∞–Ω—ã –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ 30 –≤–æ–ø—Ä–æ—Å–æ–≤
- [ ] –û–ø–∏—Å–∞–Ω—ã —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏ —Å–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è
- [ ] –£–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å AI (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å)

---

## 7. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—à–ø–∞—Ä–≥–∞–ª–∫–∞)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏:
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞
sudo insmod module.ko
sudo insmod module.ko param1=value param2=value

# –í—ã–≥—Ä—É–∑–∫–∞
sudo rmmod module_name

# –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
lsmod
lsmod | grep my_module

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ
modinfo module.ko
modinfo -p module.ko  # –¢–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

### –õ–æ–≥–∏:
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
dmesg | tail -20
dmesg | grep module_name

# –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
dmesg -w

# –° —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
dmesg -T

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
sudo dmesg -C
```

### –î–ª—è proc —Ñ–∞–π–ª–æ–≤:
```bash
# –ß—Ç–µ–Ω–∏–µ
cat /proc/myfile

# –ó–∞–ø–∏—Å—å (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
echo "value" > /proc/myfile

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la /proc/myfile
```

### –î–ª—è character devices:
```bash
# –°–æ–∑–¥–∞—Ç—å device node
sudo mknod /dev/mydevice c <MAJOR> <MINOR>

# –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chmod 666 /dev/mydevice

# –ó–∞–ø–∏—Å—å
echo "data" > /dev/mydevice

# –ß—Ç–µ–Ω–∏–µ
cat /dev/mydevice

# –£–¥–∞–ª–µ–Ω–∏–µ
sudo rm /dev/mydevice
```

### –û—Ç–ª–∞–¥–∫–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ tainted —Å—Ç–∞—Ç—É—Å–∞
cat /proc/sys/kernel/tainted

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
uname -a
cat /proc/version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π –≤ –ø–∞–º—è—Ç–∏
cat /proc/modules
```

---

## 8. –ö–æ–≥–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é

### –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å:
- –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (—á–∏—Ç–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è!)
- "Module not found" (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å)
- "Permission denied" (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sudo)
- –ú–æ–¥—É–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–æ–±–∞–≤—å—Ç–µ printk, –æ—Ç–ª–∞–¥—å—Ç–µ)

### –°—Ç–æ–∏—Ç —Å–ø—Ä–æ—Å–∏—Ç—å:
- Kernel panic –ø—Ä–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö
- –ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
- –°—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –º–æ–¥—É–ª—è
- –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç X?)

### –ì–¥–µ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å:
- Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ PR
- –£ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è/–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

**–ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–µ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ:**
- –ö–æ–¥ –º–æ–¥—É–ª—è
- –í—ã–≤–æ–¥ dmesg
- –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏
- –ß—Ç–æ –æ–∂–∏–¥–∞–ª–∏ vs —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏

---

## 9. –í–∞–∂–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

### ‚úÖ DO (–î–µ–ª–∞—Ç—å):
- –†–∞–±–æ—Ç–∞—Ç—å –≤ VM
- –î–µ–ª–∞—Ç—å snapshots
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å printk –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ß–∏—Ç–∞—Ç—å dmesg –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤ module_exit
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É/–≤—ã–≥—Ä—É–∑–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### ‚ùå DON'T (–ù–µ –¥–µ–ª–∞—Ç—å):
- –†–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å printf (—Ç–æ–ª—å–∫–æ printk!)
- –û–±—Ä–∞—â–∞—Ç—å—Å—è –∫ user-space —É–∫–∞–∑–∞—Ç–µ–ª—è–º –Ω–∞–ø—Ä—è–º—É—é
- –î–µ–ª–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã
- –ó–∞–±—ã–≤–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å
- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è

---

## 10. –†–µ—Å—É—Ä—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `man insmod`, `man rmmod`, `man lsmod`
- Kernel docs: https://www.kernel.org/doc/html/latest/
- Linux Driver Tutorial: https://sysprog21.github.io/lkmpg/

### –û—Ç–ª–∞–¥–∫–∞:
- `dmesg --help`
- `/usr/src/linux-headers-$(uname -r)/Documentation/`

### –í –∫–æ–¥–µ:
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å–∫–µ–ª–µ—Ç–∞—Ö (—Ç–∞–º –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è!)
- –û—Å–Ω–æ–≤–Ω–æ–π [README.md](README.md) (–¥–µ—Ç–∞–ª—å–Ω–∞—è —Ç–µ–æ—Ä–∏—è)

---

## –ò—Ç–æ–≥–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã

1. **–ù–µ —Å–ø–µ—à–∏—Ç–µ.** Kernel-space –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

2. **–ß–∏—Ç–∞–π—Ç–µ –æ—à–∏–±–∫–∏.** –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ —è–¥—Ä–æ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –Ω–µ —Ç–∞–∫.

3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç–æ.** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è - –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —Ç–µ—Å—Ç.

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ snapshots.** –≠—Ç–æ –≤–∞—à–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.

5. **–ù–µ –±–æ–π—Ç–µ—Å—å kernel panic.** –≠—Ç–æ –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ –≤ VM. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ snapshot –∏ –∏–¥—ë–º –¥–∞–ª—å—à–µ.

6. **–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã.** –õ—É—á—à–µ —Å–ø—Ä–æ—Å–∏—Ç—å, —á–µ–º —á–∞—Å–∞–º–∏ –∏—Å–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É.

---

**–í—Ä–µ–º—è –Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é:** 4-8 —á–∞—Å–æ–≤ (–±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å)

**–ù–∞—á–∏–Ω–∞–π—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!** üöÄ

**–ò –ø–æ–º–Ω–∏—Ç–µ: –≤—Å–µ–≥–¥–∞ –≤ VM!** üñ•Ô∏èüíæ
