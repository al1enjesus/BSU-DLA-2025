#  Лабораторная работа 2 

##  Вопросы 

1. Процесс — это независимая сущность с собственным адресным пространством, а поток делит адресное пространство с другими потоками процесса; в ps -eLf видно, что у потоков одинаковый PID, но разные LWP.

2. Параметр nice влияет на приоритет в планировщике CFS: чем выше nice, тем меньше процесс получает CPU; диапазон значений от -20 до +19.

3. CPU-аффинити закрепляет процесс за конкретным ядром, улучшая кеш-локальность, но может снижать производительность при неравномерной загрузке ядер.

4. RLIMIT_AS ограничивает всё адресное пространство процесса, RLIMIT_DATA — размер кучи, а RLIMIT_RSS — объём резидентной памяти, но часто игнорируется ядром.

5. Зомби появляются, если родитель не вызывает wait() после завершения дочернего процесса; их можно избежать, правильно обрабатывая SIGCHLD или вызывая waitpid().

6. Graceful shutdown — это корректное завершение работы с освобождением ресурсов, а graceful reload/restart — безопасное обновление конфигурации или перезапуск без остановки всей системы.

7. Контейнерные лимиты cgroup v2 ограничивают ресурсы процесса (CPU, память, I/O) и могут изменять видимые метрики, например уменьшая доступную память или долю CPU

# Задание А

##  Цель задания

Задание A (сборка и запуск супервизора и воркеров):
Цель — научиться компилировать и запускать многопроцессное приложение с супервизором и воркерами, проверить корректность передачи конфигурации и стартовых параметров.

##  Решение

Файлы: src/supervisor.py, src/worker.py

Запуск супервизора:

```
python3 src/supervisor.py --config src/config.json --workers 3
```

Проверка воркеров:

```
ps aux | grep worker.py — проверить, что все воркеры запущены

pidstat -u 1 10 -p <PID> — наблюдать CPU использование воркеров
```
Вывод: воркеры работают, PID и CPU usage видны, конфигурация применена. 


# Задание В

##  Цель задания

Задание B (изменение nice и CPU-affinity):
Цель — исследовать влияние параметров планирования (nice) и закрепления процессов за ядрами (CPU-affinity) на использование CPU и поведение воркеров.

Режимы работы:

SIGUSR1 → LIGHT mode

SIGUSR2 → HEAVY mode

```
kill -USR1 <PID воркера>
kill -USR2 <PID воркера>
```

Проверка nice и CPU affinity:

Перед запуском супервизора через config.json заданы nice_map и affinity_map

Команды проверки:

```
ps -o pid,ni,cmd -p <PID>
taskset -cp <PID>
```

Вывод статистики воркеров:

```
pidstat -u 1 10 -p <PID> — CPU load меняется при смене режимов
```

Вывод: воркеры корректно реагируют на сигналы и применяют атрибуты планирования.

```
dasha@dasha-VirtualBox:~/Desktop/BSU-DLA-2025/lab2/gr9sub2/popova_darya$ pidstat -u 1 10 -p 6376
Linux 6.14.0-29-generic (dasha-VirtualBox) 	09/25/2025 	_x86_64_	(4 CPU)

10:43:32 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
10:43:33 PM  1000      6376   48.51    0.00    0.00   39.60   48.51     1  python3
10:43:34 PM  1000      6376   51.00    0.00    0.00   37.00   51.00     1  python3
10:43:35 PM  1000      6376   48.00    1.00    0.00   40.00   49.00     1  python3
10:43:36 PM  1000      6376   46.00    0.00    0.00   44.00   46.00     1  python3
10:43:37 PM  1000      6376   50.00    0.00    0.00   38.00   50.00     1  python3
10:43:38 PM  1000      6376   50.00    1.00    0.00   38.00   51.00     1  python3
10:43:39 PM  1000      6376   54.00    0.00    0.00   34.00   54.00     1  python3
10:43:40 PM  1000      6376   49.00    0.00    0.00   40.00   49.00     1  python3
10:43:41 PM  1000      6376   50.00    0.00    0.00   39.00   50.00     1  python3
10:43:42 PM  1000      6376   44.55    0.00    0.00   45.54   44.55     1  python3
Average:     1000      6376   49.10    0.20    0.00   39.52   49.30     -  python3
```

# Задание D

##  Цель задания

Задание D (наблюдение и анализ статистики работы воркеров):
Цель — собрать и проанализировать метрики работы воркеров (использование CPU, ticks, режим работы), исследовать влияние сигналов, конфигурации и планирования на поведение процессов, выявить закономерности и оптимальные параметры работы супервизора.

Наблюдение статистики:

```
pidstat -u 1 10 -p <PID воркера>
top -p <PID>
```

Вывод: воркеры корректно перезапускаются, зомби процессов нет, метрики CPU соответствуют конфигу.

```
asha@dasha-VirtualBox:~/Desktop/BSU-DLA-2025/lab2/gr9sub2/popova_darya/src$ ./mem_touch --rss-mb 512 --step-mb 64 --sleep-ms 200
Starting mem_touch: target_mb=512 step_mb=64 sleep_ms=200 (target_steps=8)
=== start: /proc/self/status ===
Uid:	1000	1000	1000	1000
VmSize:	    2680 kB
VmRSS:	    1348 kB
[mem_touch] allocated step 1 -> total_alloc_steps=1 (64 MB)
=== after-alloc: /proc/self/status ===
Uid:	1000	1000	1000	1000
VmSize:	   68220 kB
VmRSS:	   66884 kB
[mem_touch] allocated step 2 -> total_alloc_steps=2 (128 MB)
=== after-alloc: /proc/self/status ===
Uid:	1000	1000	1000	1000
VmSize:	  133760 kB
VmRSS:	  132420 kB

```




