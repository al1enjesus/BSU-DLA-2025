# Лабораторная работа №2
**Тема:** Продвинутые процессы Linux: управление процессами, сигналы, планирование и ресурсы

## Цель работы

- Исследовать жизненный цикл процессов в Linux: создание, контроль, перезапуск и корректное завершение.  
- Реализовать обработку сигналов (`SIGTERM`, `SIGINT`, `SIGHUP`, `SIGUSR1`, `SIGUSR2`) для супервизора и воркеров.  
- Изучить влияние приоритета процесса (`nice`) и CPU-аффинити на планировщик.  
- Научиться собирать информацию о процессах через `/proc`, `ps` и `pidstat`.  
- Отработать воспроизводимость экспериментов и ведение логов.

## Используемые средства

- Linux (Ubuntu 22.04 / WSL2)  
- C++17  
- Bash  
- `make`, `kill`, `taskset`, `ps`, `pidstat`

---

## Ход работы

### 1. Сборка проекта

Компиляция осуществляется через скрипт `run.sh`, который создаёт бинарные файлы в директории `bin/`:

```bash
bush run.sh
```

## Пример вывода сборки:

rm -rf bin
g++ -std=c++17 -O2 src/supervisor.cpp -o bin/supervisor -lyaml-cpp
g++ -std=c++17 -O2 src/worker.cpp -o bin/worker
[RUN] Supervisor PID=34225

## 2. Проверка состояния процессов

Для мониторинга процессов можно использовать команду ps:

ps -o pid,comm,nice,psr -C supervisor,worker


### Результат:

    PID COMMAND          NI PSR
  34225 supervisor        0   3
  34227 worker           10   0
  34228 worker            0   1
  34229 worker           10   0


### Вывод: воркеры успешно запущены с разными приоритетами и привязкой к ядрам CPU.

## 3. Переключение режимов воркеров

Для управления рабочими режимами воркеров применяются сигналы:

kill -USR1 <SUP_PID>  # перевод в LIGHT
kill -USR2 <SUP_PID>  # перевод в HEAVY


## Пример логов воркеров при смене режима:

[WORKER 34227] Mode=LIGHT Tick=1 CPU=0
[WORKER 34228] Mode=LIGHT Tick=1 CPU=1
[WORKER 34229] Mode=LIGHT Tick=1 CPU=0
[WORKER 34227] Mode=HEAVY Tick=2 CPU=0
[WORKER 34228] Mode=HEAVY Tick=2 CPU=1
[WORKER 34229] Mode=HEAVY Tick=2 CPU=0

## 4. Корректное завершение процессов

Для завершения супервизора и всех воркеров используется сигнал SIGTERM:

kill -TERM <SUP_PID>


## Лог завершения:

[WORKER 34227] exiting
[WORKER 34228] exiting
[WORKER 34229] exiting
[SUP] Worker exited PID=34227
[SUP] Worker exited PID=34228
[SUP] Shutting down...


Все процессы корректно завершились, зомби-процессов не образовалось.

## 5. Настройка планирования

## Изменение приоритета процессов:

renice -n 10 -p 34227
renice -n 0 -p 34228


## Закрепление воркеров на ядрах:

taskset -cp 0 34227
taskset -cp 1 34228

 Выводы наблюдений:

Воркеры с меньшим nice получают больше времени CPU.

 Аффинити к ядру уменьшает миграцию процесса между ядрами, что может ускорять выполнение, но снижает гибкость планировщика.

## 6. Воспроизводимость эксперимента

 Компиляция:

./run.sh


Переключение режимов воркеров:

kill -USR1 <SUP_PID>
kill -USR2 <SUP_PID>


Graceful shutdown:

kill -TERM <SUP_PID>


Проверка состояния процессов:

ps -o pid,comm,nice,psr -C supervisor,worker

# Ответы на контрольные вопросы

Процесс vs поток:
Процесс имеет отдельное адресное пространство, PID и ресурсы. Поток разделяет память процесса, но имеет свой идентификатор (TID).

Влияние nice:
Смещает приоритет в планировщике CFS. Меньшее значение → выше приоритет. Диапазон: -20 … +19.

CPU-аффинити:
Закрепляет процесс за конкретным ядром. Повышает предсказуемость кеширования, но снижает гибкость распределения нагрузки.

Различия RLIMIT:

RLIMIT_AS: ограничение виртуальной памяти.

RLIMIT_DATA: ограничение сегмента данных.

RLIMIT_RSS: ограничение физической памяти (RAM).

Почему возможны зомби:
Родитель не вызвал wait после завершения воркера.

Graceful shutdown vs reload:

Shutdown: завершение всех воркеров.

Reload: перезапуск воркеров с новой конфигурацией без потери данных.

Контейнерные лимиты (cgroup v2):
Ограничивают память, CPU и другие ресурсы, отражаются в /proc/<pid>/status. Могут вызвать OOM.