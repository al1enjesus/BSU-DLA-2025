# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ4  
## –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã: –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∏ —è–¥—Ä–æ–º  
**–ê–≤—Ç–æ—Ä:** –ü–æ–ª—è–∫–æ–≤ –ê–Ω–¥—Ä–µ–π 
**–í–∞—Ä–∏–∞–Ω—Ç:** 19 

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

### –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç run.sh –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é —Å–±–æ—Ä–∫—É –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:

–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É libsyscall_spy.so;

—Å–æ–±–∏—Ä–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (hello, hello_static, benchmark);

–ø—Ä–æ–≤–æ–¥–∏—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã A –∏ B;

—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–∞–ø–∫—É logs/.

–ó–∞–ø—É—Å–∫:
```bash
sudo bash run.sh
```
**–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω sudo**

–ò–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã perf stat (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —á–∞—Å—Ç–∏ B) —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º —Å—á—ë—Ç—á–∏–∫–∞–º CPU.

–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫—ç—à–µ–º:
–°–∫—Ä–∏–ø—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–π –∫—ç—à –∫–æ–º–∞–Ω–¥–æ–π
echo 3 > /proc/sys/vm/drop_caches

–≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ—Ç –∏–º–µ–Ω–∏ root.

–¢–æ—á–Ω–æ—Å—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:
–ë–µ–∑ sudo —á–∞—Å—Ç—å –º–µ—Ç—Ä–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, cache-misses, page-faults) –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥—É—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª–∏.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ logs/:
ls -l logs/

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤:
cat logs/gcc_analysis.log      # –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã gcc
cat logs/make_analysis.log     # –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã make
cat logs/as_analysis.log       # –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã as
cat logs/benchmark_output.log  # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–∞
cat logs/perf_stats.log        # –¥–∞–Ω–Ω—ã–µ perf stat

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –≤—Ä—É—á–Ω—É—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–°–±–æ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤—Ä—É—á–Ω—É—é
gcc -shared -Wall -O2 -fPIC -Wno-nonnull-compare -o libsyscall_spy.so syscall_spy.c -ldl

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
file libsyscall_spy.so
ldd libsyscall_spy.so

2. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç LD_PRELOAD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—ã–∑–æ–≤–æ–≤ –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
LD_PRELOAD=./libsyscall_spy.so ./hello

–î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
LD_PRELOAD=./libsyscall_spy.so ./hello_static

3. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
make clean

–∏–ª–∏ –≤—Ä—É—á–Ω—É—é

rm -f *.so *.o hello hello_static benchmark testprog
rm -rf logs/

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:**
========================================
Experiments completed!
All detailed logs saved in logs/ directory
========================================

–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ logs/, –∞ —Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

